## <center>WEB INFO LAB1实验报告</center>

### <center>PB19000352 易元昆 PB19000186 王晨晗</center>

### bool检索

 > 对于经过预处理的文档集合 $D=\{D_1,D_2,...,D_N\}$，根据倒排索引算法建立倒排索引表 ，并以合适的方式存储生成的倒排索引文件。

   1.首先对原文档进行预处理，经过变小写、去除停用词、词干化（对应库函数为nltk.stem.SnowballStemmer）之后得到名为{文件夹名称}.{原文件名称}的中间文档集合。这里调用的库函数有nltk巴拉巴拉（**这段yyk补一下吧，orz**）

​	2.对经过预处理的文档集合内容进行统计，按照倒排索引算法建立倒排索引表，其中表中还添加了词项在文档中出现的次数作为排序的判断标准。即，对于未出现的词项，建立新的键值对，对于出现的词项，若文档ID已存在，计数+1，未存在，则初始化{文档ID:1}。

​	3.得到的倒排索引表存入./IndexTable.txt文件。



 >  对于给定的 bool 查询 （ 的书写规则以上课内容为准），根据你生成的倒排索引表 ，返回符合查询规则 的文档集合 。

​	1.利用ply库，建立lexer和parser，实现对于输入的bool检索表达式的分析。这里的具体语法学习来自于编译原理实验和CSDN。其中对于输入的停用词会返回错误提示，处理时将停用词对应文档集合视作空集合。

​	2.对于and、or、not，为了区分与正常查找词区别，输入后用replace函数将其变为大写，方便分析。在处理过程中，AND、OR会分别通过简单的方式改变相关文档排序优先级，具体如图。

![bool_1](.\bool_1.png)

![bool_2](.\bool_2.png)

​	3.最终通过全局变量result将查找到的相关文档路径存入./output/bool_search_result文件夹，并将排序结果靠前的文档输出在命令行，个数由变量search_num指定。

![](.\bool_3.png)

![bool_4](.\bool_4.png)



> 一些要点

​	1.词干化的库函数对于一些词无法将它恢复至正确词根，比如`created`词干化后会变为`creat`而非`create`，但是该库函数可以令`create`同样变为`creat`。因此对于输入的查询项，我们对其进行词干化后再去倒排索引表中查找，这样同样可以达到想要的效果

​	2.这里bool检索的相关性只利用了文档中词项出现次数作为参数，较为简略，主要考虑到bool检索本身的限制以及题目中未要求排序，就没有进一步使用更准确的消除各种影响因素的参数。



整体运行时间约为25min。





### TF-IDF 

***源码附在最后***

1. 检索所有文件夹，读取其中的text项目。调用库函数，进行分词、去停用词，词频统计，计算tf-idf。

通过[get_data.py](./src/semantic_search/get_data.py)文件实现

其中通过遍历所有json文件读取其中的`text`相关内容，并分别和所读取的文件路径存储与两个`list`表里面，通过`list[0]~list[len(list_file)]`调用不同文件的`text`相关信息。

调用库`scikit-learn`中的文本处理模块进行处理，其中``用于对原始数据进行处理包括标准化和去停用词，`TfidfTransformer`用于生成tf-idf矩阵。

生成完毕后一同存储与`tfidf_matrix.txt`文件中(分词后的词排序用`feature_name`存储，生成的tf-idf矩阵用`tf-idf`存储，存储类型为`scipy.sparse.csr.csr_matrix`稀疏矩阵，生成的字频统计用`count`存储，调用时按顺序读出)

存储是通过python库`pickle`实现，`pickle`库可以实现python`list、dict`等数据类型的存储和读取，方便后续处理数据

读取数据和建立矩阵大致需要5-8分钟(运行环境见[readme](readme.md))

1. 输入相应查询词，进行计算

通过[search.py](./src/semantic_search/search.py)文件实现

读入先前处理过的数据， 读入输入的查询词集合。对输入的查询词进行处理(仍然使用`vectorizer = CountVectorizer(vocabulary=feature_name)`此处附带参数为按照步骤2中生成的分词表生成稀疏矩阵)， 然后计算查询词的tf-idf向量。

通过`cosine_similarity()`函数计算查询词集合向量与原来生成的tf-idf向量的VSM，并返回最相似的10个文件的集合，然后输出

测试结果(此时数据集在src文件夹内，提交时已经更改)
![](1.png)

此为简单单词的查询处理,运行时间7 min 55 s

![](2.png)

此处输入了查词表中2/3的单词，输出结果如上所示，运行时间为9 min 23 s
